# DNS Traffic
set rulebase security rules Allow-DNS from User to External source any destination any application dns-base service application-default action allow
set rulebase security rules Allow-DNS from Public to External source any destination any application dns-base service application-default action allow
# HTTP/HTTPS Traffic
set rulebase security rules Allow-HTTP-HTTPS from User to External source any destination any application web-browsing service application-default action allow
set rulebase security rules Allow-HTTP-HTTPS from User to External source any destination any application ssl service application-default action allow
set rulebase security rules Allow-HTTP-HTTPS from Public to External source any destination any application web-browsing service application-default action allow
set rulebase security rules Allow-HTTP-HTTPS from Public to External source any destination any application ssl service application-default action allow
# SMTP Traffic
set rulebase security rules Allow-SMTP from User to External source any destination any application smtp-base service application-default action allow
set rulebase security rules Allow-SMTP from Public to External source any destination any application smtp-base service application-default action allow
# NTP Traffic
set rulebase security rules Allow-NTP from User to External source any destination any application ntp-base service application-default action allow
set rulebase security rules Allow-NTP from Public to External source any destination any application ntp-base service application-default action allow
# ICMP Traffic
set rulebase security rules Allow-ICMP from User to any source any destination any application ping service application-default action allow
set rulebase security rules Allow-ICMP from Public to any source any destination any application ping service application-default action allow
# DNS (External → Internal DNS Server)
set rulebase security rules Allow-Inbound-DNS from External to User source any destination any application dns-base service application-default action allow log-start yes log-end yes
set rulebase security rules Allow-Inbound-DNS from External to Public source any destination any application dns-base service application-default action allow log-start yes log-end yes
# SMTP (External → Internal Mail Server)
set rulebase security rules Allow-Inbound-SMTP from External to Public source any destination 172.20.241.30 application smtp-base service application-default action allow log-start yes log-end yes
set rulebase security rules Allow-Inbound-SMTP from External to Public source any destination 172.20.241.40 application smtp-base service application-default action allow log-start yes log-end yes
# HTTP/HTTPS (External → Internal Web Server)
set rulebase security rules Allow-Inbound-HTTP-HTTPS from External to User source any destination any application web-browsing service application-default action allow
set rulebase security rules Allow-Inbound-HTTP-HTTPS from External to User source any destination any application ssl service application-default action allow
set rulebase security rules Allow-Inbound-HTTP-HTTPS from External to Public source any destination any application web-browsing service application-default action allow
set rulebase security rules Allow-Inbound-HTTP-HTTPS from External to Public source any destination any application ssl service application-default action allow
# POP3 (External → Internal Mail Retrieval Server)
set rulebase security rules Allow-Inbound-POP3 from External to Public source any destination 172.20.241.40 application pop3 service application-default action allow log-start yes log-end yes
# NTP (External → Internal NTP Server)
set rulebase security rules Allow-Inbound-NTP from External to Internal source any destination 172.20.240.20 application ntp-base service application-default action allow
# ICMP (External → Internal Diagnostic)
set rulebase security rules Allow-Inbound-ICMP from External to any source any destination any application ping service application-default action allow log-start yes log-end yes




# Debian Create Outbound Rule for Application-Default
set rulebase security rules Debian-Outbound-AppDefault from Internal to External source 172.20.240.20 destination any action allow service application-default

set rulebase security rules Debian-Outbound-AppDefault application dns-base
set rulebase security rules Debian-Outbound-AppDefault application ntp-base
set rulebase security rules Debian-Outbound-AppDefault application web-browsing
set rulebase security rules Debian-Outbound-AppDefault application ssl

# Create Custom Services
set service RNDC-953 protocol tcp port 953
set service RNDC-953 protocol udp port 953
set service Syslog-601 protocol tcp port 601
set service Syslog-601 protocol udp port 601

# Debian Create Outbound Rule for Custom Services
set rulebase security rules Debian-Outbound-Custom from Internal to External source 172.20.240.20 destination any action allow

set rulebase security rules Debian-Outbound-Custom service RNDC-953
set rulebase security rules Debian-Outbound-Custom service Syslog-601

# Debian Create Inbound Rule
set rulebase security rules Debian-Inbound from External to Internal source any destination 172.20.240.20 action allow service application-default

set rulebase security rules Debian-Inbound application dns-base
set rulebase security rules Debian-Inbound application ntp-base
set rulebase security rules Debian-Inbound application web-browsing
set rulebase security rules Debian-Inbound application ssl

set rulebase security rules Debian-Inbound service RNDC-953
set rulebase security rules Debian-Inbound service Syslog-601

# Debian Create Inbound Rule for Application-Default
set rulebase security rules Debian-Inbound-AppDefault from External to Internal source any destination 172.20.240.20 action allow service application-default

set rulebase security rules Debian-Inbound-AppDefault application dns-base
set rulebase security rules Debian-Inbound-AppDefault application ntp-base
set rulebase security rules Debian-Inbound-AppDefault application web-browsing
set rulebase security rules Debian-Inbound-AppDefault application ssl

# Debian Create Inbound Rule for Custom Services
set rulebase security rules Debian-Inbound-Custom from External to Internal source any destination 172.20.240.20 action allow

set rulebase security rules Debian-Inbound-Custom service RNDC-953
set rulebase security rules Debian-Inbound-Custom service Syslog-601





# Create WebMail-Inbound Rule
set rulebase security rules WebMail-Inbound from External to Public source any destination 172.20.241.40 action allow service application-default

set rulebase security rules WebMail-Inbound application smtp
set rulebase security rules WebMail-Inbound application pop3
set rulebase security rules WebMail-Inbound application imap
set rulebase security rules WebMail-Inbound application web-browsing
set rulebase security rules WebMail-Inbound application ssl
set rulebase security rules WebMail-Inbound application ntp-base


# Splunk set up and logging


# Allow DNS (User → External)
set rulebase security rules Allow-DNS from User to External application dns service application-default action allow log-start yes log-end yes

# Allow HTTP/HTTPS (User → External)
set rulebase security rules Allow-HTTP-HTTPS from User to External application web-browsing ssl service application-default action allow log-start yes log-end yes

# Allow SMTP/POP3 (User → External)
set rulebase security rules Allow-SMTP-POP3 from User to External application smtp pop3 service application-default action allow log-start yes log-end yes

# Allow NTP (User → External)
set rulebase security rules Allow-NTP from User to External application ntp service application-default action allow log-start yes log-end yes

# Allow ICMP (Diagnostics - User → Any)
set rulebase security rules Allow-ICMP from User to any application ping service application-default action allow log-start yes log-end yes

# Deny Unauthorized Traffic (Final Deny Rule for User)
set rulebase security rules Deny-Unauthorized from User to any application any service any action deny log-start yes log-end yes
